(function(){var d="dsmenu";var c={animation:true,animationDuration:"normal",margin:[3,3],maxSize:false,row:{initial:3,max:6,min:1},scroll:true,sortable:true};var a=function(i,e,l,k,f,g,j){i.position({of:k,at:"left top",my:"left top",offset:e+" "+l,using:function(h){i.animate({top:h.top,left:h.left,width:f,height:g},j,function(){i.attr({x:e,y:l})})},collision:"fit fit"})};var b={init:function(e){if(!e){e={}}c=$.extend(true,c,e);$(this).each(function(){var g=c.row.initial;console.log($(this));$.data(this,"row",c.row.initial);$(this).css({position:"relative"});var f=$(this).find("li").css({width:"30px",height:"30px",position:"absolute",display:"block",right:0,bottom:0});$(this)[d]("setRow",c.row.initial)});return this},setRow:function(e,f){$(this).each(function(){var h=e;if(h<c.row.min||h>c.row.max){return true}$.data(this,"row",h);var g=$(this);$(this).find("li").each(function(m){$cell=$(this);var l=(g.innerHeight()-c.margin[1]*(h+1))/h;var n,k;if(typeof(c.maxSize)==="object"){n=Math.min(l/h,c.maxSize[1]);k=Math.min(l,c.maxSize[0])}else{if(typeof(c.maxSize)==="number"){n=Math.min(l,c.maxSize);k=Math.min(l,c.maxSize)}else{n=l;k=l}}marginTop=(g.innerHeight()-(c.margin[1]*(h-1)+n*h))/2;var j=(c.margin[0]+(k+c.margin[0])*Math.floor(m/h));var p=(marginTop+(n+c.margin[1])*(m%h));var o=f?c.animationDuration:0;if(c.sortable){$cell.draggable({cursorAt:{top:n/2,left:k/2},delay:500,opacity:0.5,revert:"invalid",revertDuration:100,zIndex:9999});$cell.droppable({accept:g.find("li"),drop:function(r,s){var t=c.animation?c.animationDuration:0;var i=s.draggable;var v=$(this);var u={x:i.attr("x"),y:i.attr("y")};var q={x:v.attr("x"),y:v.attr("y")};a(i,q.x,q.y,g,k,n,t);a(v,u.x,u.y,g,k,n,t);$drop2=v.clone().insertAfter(v);$drag2=i.clone().insertAfter(i);$drag2.replaceWith(v);$drop2.replaceWith(i)}})}a($cell,j,p,g,k,n,o)})});return this},row:function(){return $.map($(this).get(),function(f,e){return $.data(f,"row")});return this},expand:function(){$(this).each(function(){var f=$.data(this,"row");if(f<c.row.max){var e=f+1;$(this)[d]("setRow",e,c.animation)}});return this},contract:function(){$(this).each(function(){var f=$.data(this,"row");if(f>Math.max(0,c.row.min)){var e=f-1;$(this)[d]("setRow",e,c.animation)}});return this}};$.fn[d]=function(e){if(e){return b[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return b.init.apply(this,arguments)}else{$.error("Method "+e+" does not exist on jQuery."+d);return this}}}})(jQuery);